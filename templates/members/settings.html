{% extends 'members/base.html' %}
{% block title %}Settings{% endblock %}
{% block content %}
<style>
  .tab-bar {
    background: linear-gradient(90deg, #232946 0%, #6dd5ed 100%);
    border-radius: 2rem;
    box-shadow: 0 4px 24px #6dd5ed33, 0 0 8px #e11d7433;
    padding: 0.5rem;
    margin-bottom: 2rem;
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    max-width: 90%;
    margin-left: auto;
    margin-right: auto;
  }
  .tab-button {
    font-size: 1.1rem;
    font-weight: 600;
    padding: 0.75rem 2.5rem;
    border-radius: 2rem;
    background: rgba(30,41,59,0.85);
    color: #fff;
    border: none;
    box-shadow: 0 2px 8px #2193b033;
    transition: all 0.2s cubic-bezier(.4,2,.3,1);
    cursor: pointer;
    outline: none;
    letter-spacing: 0.02em;
  }
  .tab-button.active, .tab-button:focus {
    background: linear-gradient(90deg, #6dd5ed 0%, #e11d74 100%);
    color: #fff;
    box-shadow: 0 0 16px #6dd5edcc, 0 0 8px #e11d74cc;
    transform: scale(1.07);
  }
  .tab-button:not(.active):hover {
    background: #334155;
    color: #6dd5ed;
    box-shadow: 0 0 8px #6dd5ed77;
  }
  .tab-button span {
    display: block;
    line-height: 1.1;
  }
</style>
<div class="w-full mx-auto mt-10 px-4">
  <h1 class="text-3xl font-bold neon mb-8 text-center">Settings</h1>
  <!-- Profile Section -->
  <div class="bg-slate-900/80 rounded-xl shadow-lg p-8 mb-8">
    <h2 class="text-xl font-semibold mb-6 text-blue-300">Profile</h2>
    <div class="space-y-4">
      <form method="post" action="" autocomplete="off">
        {% csrf_token %}
        <div class="flex flex-col md:flex-row md:items-center md:gap-4 mb-4">
          <label for="profile_name" class="w-32 text-blue-200 font-medium">Profile Name:</label>
          <input type="text" id="profile_name_input" name="profile_name" value="{% if request.user.profile %}{{ request.user.profile.profile_name }}{% else %}{% endif %}" placeholder="Enter your name" class="flex-1 bg-slate-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" readonly />
          <button type="button" id="profile_name_btn" class="ml-2 px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition">Edit</button>
        </div>
        <div class="flex flex-col md:flex-row md:items-center md:gap-4 mb-4">
          <label for="name" class="w-32 text-blue-200 font-medium">Contact:</label>
          <input type="text" id="name" name="name" value="{{ request.user.get_full_name|default:request.user.username }}" class="flex-1 bg-slate-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" readonly />
        </div>
        <div class="flex flex-col md:flex-row md:items-center md:gap-4 mb-4">
          <label for="email" class="w-32 text-blue-200 font-medium">Email:</label>
          <input type="email" id="email_input" name="email" value="{% if request.user.profile and request.user.profile.email %}{{ request.user.profile.email }}{% else %}{{ request.user.email }}{% endif %}" class="flex-1 bg-slate-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" readonly />
          <button type="button" id="email_btn" class="ml-2 px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition">Edit</button>
        </div>
        <!-- AJAX Save/Edit logic will be handled by JavaScript below -->
      </form>
      <script>
        function toggleEdit(inputId, btnId, url, field) {
          const input = document.getElementById(inputId);
          const btn = document.getElementById(btnId);
          let editing = false;
          btn.addEventListener('click', function() {
            if (!editing) {
              input.readOnly = false;
              input.focus();
              btn.textContent = 'Save';
              editing = true;
            } else {
              // Save via AJAX
              const value = input.value;
              btn.disabled = true;
              fetch(url, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: JSON.stringify({ [field]: value })
              })
              .then(r => r.json())
              .then(data => {
                if (data.success) {
                  input.readOnly = true;
                  btn.textContent = 'Edit';
                  editing = false;
                } else {
                  alert(data.error || 'Save failed');
                }
              })
              .catch(() => alert('Save failed'))
              .finally(() => { btn.disabled = false; });
            }
          });
        }
        document.addEventListener('DOMContentLoaded', function() {
          toggleEdit('profile_name_input', 'profile_name_btn', '{% url "members:ajax_update_profile_name" %}', 'profile_name');
          toggleEdit('email_input', 'email_btn', '{% url "members:ajax_update_email" %}', 'email');
        });
      </script>
      </form>
      <div class="flex flex-col md:flex-row md:items-center md:gap-4 mb-2">
        <label class="w-32 text-blue-200 font-medium">Password:</label>
        <a href="#" class="text-blue-400 hover:underline">Reset Password</a>
      </div>
      <div class="flex flex-col md:flex-row md:items-center md:gap-4 mb-2">
        <label class="w-32 text-blue-200 font-medium">Demo:</label>
        <span class="text-blue-400">Coming soon...</span>
      </div>
    </div>
  </div>
  <!-- File Setting Section -->
  <!-- Radio Section -->
  <div class="bg-slate-900/80 rounded-xl shadow-lg p-8 mb-8">
    <h2 class="text-xl font-semibold mb-6 text-blue-300">Box Options</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="flex items-center space-x-2 mb-4 md:mb-0">
        <input id="box1" name="box-group" type="checkbox" class="accent-blue-500 w-5 h-5 rounded border-2 border-blue-400 focus:ring-2 focus:ring-blue-400" />
        <label for="box1" class="text-blue-200">Demo 1</label>
      </div>
      <div class="flex items-center space-x-2 mb-4 md:mb-0">
        <input id="box2" name="box-group" type="checkbox" class="accent-blue-500 w-5 h-5 rounded border-2 border-blue-400 focus:ring-2 focus:ring-blue-400" />
        <label for="box2" class="text-blue-200">Demo 2</label>
      </div>
      <div class="flex items-center space-x-2 mb-4 md:mb-0">
        <input id="box3" name="box-group" type="checkbox" class="accent-blue-500 w-5 h-5 rounded border-2 border-blue-400 focus:ring-2 focus:ring-blue-400" />
        <label for="box3" class="text-blue-200">Demo 3</label>
      </div>
      <div class="flex items-center space-x-2">
        <input id="box4" name="box-group" type="checkbox" class="accent-blue-500 w-5 h-5 rounded border-2 border-blue-400 focus:ring-2 focus:ring-blue-400" {% if request.user.profile and request.user.profile.include_email_in_vcf %}checked{% endif %}/>
        <label for="box4" class="text-blue-200">Include my email</label>
      </div>
      <div class="flex items-center space-x-2">
        <input id="box5" name="box-group" type="checkbox" class="accent-blue-500 w-5 h-5 rounded border-2 border-blue-400 focus:ring-2 focus:ring-blue-400" />
        <label for="box5" class="text-blue-200">Demo 5</label>
      </div>
      <div class="flex items-center space-x-2">
        <input id="box6" name="box-group" type="checkbox" class="accent-blue-500 w-5 h-5 rounded border-2 border-blue-400 focus:ring-2 focus:ring-blue-400" />
        <label for="box6" class="text-blue-200">Demo 6</label>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const box4 = document.getElementById('box4');
        box4.addEventListener('change', function() {
          fetch('{% url "members:ajax_update_include_email" %}', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({ include_email_in_vcf: box4.checked })
          })
          .then(r => r.json())
          .then(data => {
            if (!data.success) {
              alert(data.error || 'Could not update email preference');
            }
          })
          .catch(() => alert('Could not update email preference'));
        });
      });
    </script>
  </div>
  <!-- File Setting Section -->
  <div class="bg-slate-900/80 rounded-xl shadow-lg p-8">
    <h2 class="text-xl font-semibold mb-6 text-blue-300">File Settings</h2>
    <div class="text-blue-400">(Coming soon...)</div>
  </div>
</div>
{% endblock %}
